<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coin Detail | CryptoPulse</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <div class="logo"><a href="index.html">Crypto<span>Pulse</span></a></div>
  </header>

  <main class="coin-detail">
    <h1 id="coinName">Loading...</h1>
    <div id="coinData" class="coin-info">Loading data...</div>
    <canvas id="coinDetailChart" height="100"></canvas>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const params = new URLSearchParams(window.location.search);
    const coinId = params.get('id');
    const nameEl = document.getElementById('coinName');
    const dataEl = document.getElementById('coinData');

    async function loadCoinDetail() {
      try {
        const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}`);
        const data = await res.json();

        nameEl.textContent = `${data.name} (${data.symbol.toUpperCase()})`;

        dataEl.innerHTML = `
          <p><strong>Current Price:</strong> $${data.market_data.current_price.usd.toLocaleString()}</p>
          <p><strong>Market Cap:</strong> $${data.market_data.market_cap.usd.toLocaleString()}</p>
          <p><strong>Total Volume:</strong> $${data.market_data.total_volume.usd.toLocaleString()}</p>
          <p><strong>24h Change:</strong> ${data.market_data.price_change_percentage_24h.toFixed(2)}%</p>
        `;

        loadChart();

      } catch (err) {
        nameEl.textContent = "Error loading data.";
        dataEl.textContent = "Check your internet connection or try again later.";
      }
    }

    async function loadChart() {
      const res = await fetch(`https://api.coingecko.com/api/v3/coins/${coinId}/market_chart?vs_currency=usd&days=7`);
      const chartData = await res.json();

      const labels = chartData.prices.map(p => new Date(p[0]).toLocaleDateString());
      const prices = chartData.prices.map(p => p[1]);

      const ctx = document.getElementById('coinDetailChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${coinId.toUpperCase()} Price (USD)`,
            data: prices,
            borderColor: '#00f0ff',
            tension: 0.4,
            fill: true,
            backgroundColor: 'rgba(0,240,255,0.1)'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: document.body.classList.contains("light") ? "#000" : "#fff"
              }
            }
          },
          scales: {
            x: { ticks: { color: document.body.classList.contains("light") ? "#000" : "#fff" } },
            y: { ticks: { color: document.body.classList.contains("light") ? "#000" : "#fff" } }
          }
        }
      });
    }

    loadCoinDetail();
  </script>
</body>
</html>
